<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>turns - Go Documentation Server</title>

<link type="text/css" rel="stylesheet" href="../../../../../../lib/godoc/style.css">

<script>window.initFuncs = [];</script>
<script src="../../../../../../lib/godoc/jquery.js" defer></script>



<script>var goVersion = "go1.24.7";</script>
<script src="../../../../../../lib/godoc/godocs.js" defer></script>
</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="http://localhost:8888/pkg/">Go Documentation Server</a></div>
<div class="top-heading" id="heading-narrow"><a href="http://localhost:8888/pkg/">GoDoc</a></div>
<a href="index.html#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>
<form method="GET" action="http://localhost:8888/search">
<div id="menu">

<span class="search-box"><input type="search" id="search" name="q" placeholder="Search" aria-label="Search" required><button type="submit"><span><!-- magnifying glass: --><svg width="24" height="24" viewBox="0 0 24 24"><title>submit search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg></span></button></span>
</div>
</form>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package turns
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "github.com/kijimaD/ruins/lib/turns"</code></dd>
			</dl>
			<dl>
			<dd><a href="index.html#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="index.html#pkg-index" class="indexLink">Index</a></dd>
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>Package turns はゲーム内のターン管理システムを提供する。
<h3 id="hdr-__">概要</h3>
<p>CDDAスタイルのプレイヤー優先ターンシステムを実装している。
プレイヤーが移動ポイント（Moves）を消費してアクションを実行し、
移動ポイントが尽きた後にAIが一括処理される。
<h3 id="hdr-__">責務</h3>
<p>- ターンフェーズ管理（プレイヤーターン → AIターン → ターン終了）
- 移動ポイント管理とアクションコスト制御
- プレイヤーとAIの処理順序制御
- アクション実行可否の判定
<h3 id="hdr-____">使い分け</h3>
<p>## TurnManager
- ターンフェーズとプレイヤー移動ポイントの管理
- アクション実行可否の判定（CanPlayerAct）
- ターン進行制御（StartNewTurn）
<p>## ActionCosts（将来実装予定）
- アクション別のコスト定義
- 動的コスト計算
<h3 id="hdr-__________">他パッケージとの関係</h3>
<p>```
systems → turns.CanPlayerAct() → 実行可否判定
<pre>↓           ↑
</pre>
<p>actions → turns.ConsumePlayerMoves() → コスト消費
```
<p>## 責務の境界
<p>- **turns**: いつ誰が行動できるか（When &amp; Who）
- **systems**: 何の入力を受け取るか（What Input）
- **actions**: どのような行動をするか（What Action）
<h3 id="hdr-__">仕様</h3>
<p>## ターン実行順序
1. プレイヤーターン: 移動ポイントが尽きるまで連続実行
2. AIターン: 全AI・NPCを一括処理
3. ターン終了: 次ターンの準備処理
<p>## 移動ポイント制
- プレイヤーは1ターン開始時に100ポイントを獲得
- 各アクション実行時にコストを消費
- 移動ポイントが0以下になるとAIターンに移行
<p>## プレイヤーとAIの違い
- **プレイヤー**: PlayerMovesによる移動ポイント管理
- **AI**: TurnBasedコンポーネントによるActionPoints管理
- 両者は異なるシステムで管理されるが、最終的にはターン制御で統合
<p>## CDDAとの違い
- CDDAはより複雑な時間管理システムを持つ
- Ruinsは簡略化したターンベースシステム
- CDDAのmove_costに対応するコスト概念を簡略化
<h3 id="hdr-___">実装例</h3>
<pre>// ターン管理の基本的な使用
turnManager := turns.NewTurnManager()

// アクション実行前のチェック
if turnManager.CanPlayerAct() {
	// アクション実行
	// ...
	// コスト消費
	turnManager.ConsumePlayerMoves(&quot;移動&quot;, 100)
}

// ターン進行
if turnManager.IsAITurn() {
	// AI処理
	// ...
	turnManager.StartNewTurn()
}
</pre>

				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
			
			
			
				
				<dd><a href="index.html#TurnManager">type TurnManager</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#NewTurnManager">func NewTurnManager() *TurnManager</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TurnManager.AdvanceToAITurn">func (tm *TurnManager) AdvanceToAITurn()</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TurnManager.AdvanceToTurnEnd">func (tm *TurnManager) AdvanceToTurnEnd()</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TurnManager.CalculateMaxActionPoints">func (tm *TurnManager) CalculateMaxActionPoints(world w.World, entity ecs.Entity) int</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TurnManager.CanEntityAct">func (tm *TurnManager) CanEntityAct(world w.World, entity ecs.Entity, cost int) bool</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TurnManager.CanPlayerAct">func (tm *TurnManager) CanPlayerAct() bool</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TurnManager.ConsumeActionPoints">func (tm *TurnManager) ConsumeActionPoints(world w.World, entity ecs.Entity, actionName string, cost int) bool</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TurnManager.ConsumePlayerMoves">func (tm *TurnManager) ConsumePlayerMoves(actionName string, cost int)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TurnManager.IsAITurn">func (tm *TurnManager) IsAITurn() bool</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TurnManager.IsPlayerTurn">func (tm *TurnManager) IsPlayerTurn() bool</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TurnManager.RestoreAllActionPoints">func (tm *TurnManager) RestoreAllActionPoints(world w.World)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TurnManager.StartNewTurn">func (tm *TurnManager) StartNewTurn()</a></dd>
				
			
				
				<dd><a href="index.html#TurnPhase">type TurnPhase</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#TurnPhase.String">func (tp TurnPhase) String() string</a></dd>
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/doc.go">doc.go</a>
			
				<a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go">manager.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
		
		
		
			
			
			<h2 id="TurnManager">type <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=715:938#L26">TurnManager</a>
				<a class="permalink" href="index.html#TurnManager">&#xb6;</a>
				
				
			</h2>
			<p>TurnManager はターンの管理を行う

			<pre>type TurnManager struct {
<span id="TurnManager.PlayerMoves"></span>    PlayerMoves <a href="http://localhost:8888/pkg/builtin/#int">int</a>       <span class="comment">// プレイヤーの残り移動ポイント</span>
<span id="TurnManager.TurnPhase"></span>    TurnPhase   <a href="index.html#TurnPhase">TurnPhase</a> <span class="comment">// 現在のターンフェーズ</span>
<span id="TurnManager.TurnNumber"></span>    TurnNumber  <a href="http://localhost:8888/pkg/builtin/#int">int</a>       <span class="comment">// ターン番号</span>
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewTurnManager">func <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=997:1031#L34">NewTurnManager</a>
					<a class="permalink" href="index.html#NewTurnManager">&#xb6;</a>
					
					
				</h3>
				<pre>func NewTurnManager() *<a href="index.html#TurnManager">TurnManager</a></pre>
				<p>NewTurnManager は新しいTurnManagerを作成する

				
				
			

			
				
				<h3 id="TurnManager.AdvanceToAITurn">func (*TurnManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=1934:1974#L65">AdvanceToAITurn</a>
					<a class="permalink" href="index.html#TurnManager.AdvanceToAITurn">&#xb6;</a>
					
					
				</h3>
				<pre>func (tm *<a href="index.html#TurnManager">TurnManager</a>) AdvanceToAITurn()</pre>
				<p>AdvanceToAITurn はAIターンに強制移行する（待機など）

				
				
				
			
				
				<h3 id="TurnManager.AdvanceToTurnEnd">func (*TurnManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=2127:2168#L71">AdvanceToTurnEnd</a>
					<a class="permalink" href="index.html#TurnManager.AdvanceToTurnEnd">&#xb6;</a>
					
					
				</h3>
				<pre>func (tm *<a href="index.html#TurnManager">TurnManager</a>) AdvanceToTurnEnd()</pre>
				<p>AdvanceToTurnEnd はターン終了に移行する

				
				
				
			
				
				<h3 id="TurnManager.CalculateMaxActionPoints">func (*TurnManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=2960:3045#L99">CalculateMaxActionPoints</a>
					<a class="permalink" href="index.html#TurnManager.CalculateMaxActionPoints">&#xb6;</a>
					
					
				</h3>
				<pre>func (tm *<a href="index.html#TurnManager">TurnManager</a>) CalculateMaxActionPoints(world <a href="../world/index.html">w</a>.<a href="../world/index.html#World">World</a>, entity <a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/">ecs</a>.<a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/#Entity">Entity</a>) <a href="http://localhost:8888/pkg/builtin/#int">int</a></pre>
				<p>CalculateMaxActionPoints はエンティティの最大アクションポイントを計算する
CDDAスタイルで敏捷性を重視したAP計算式

				
				
				
			
				
				<h3 id="TurnManager.CanEntityAct">func (*TurnManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=4806:4890#L162">CanEntityAct</a>
					<a class="permalink" href="index.html#TurnManager.CanEntityAct">&#xb6;</a>
					
					
				</h3>
				<pre>func (tm *<a href="index.html#TurnManager">TurnManager</a>) CanEntityAct(world <a href="../world/index.html">w</a>.<a href="../world/index.html#World">World</a>, entity <a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/">ecs</a>.<a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/#Entity">Entity</a>, cost <a href="http://localhost:8888/pkg/builtin/#int">int</a>) <a href="http://localhost:8888/pkg/builtin/#bool">bool</a></pre>
				<p>CanEntityAct はエンティティがアクション可能かチェックする

				
				
				
			
				
				<h3 id="TurnManager.CanPlayerAct">func (*TurnManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=1264:1306#L44">CanPlayerAct</a>
					<a class="permalink" href="index.html#TurnManager.CanPlayerAct">&#xb6;</a>
					
					
				</h3>
				<pre>func (tm *<a href="index.html#TurnManager">TurnManager</a>) CanPlayerAct() <a href="http://localhost:8888/pkg/builtin/#bool">bool</a></pre>
				<p>CanPlayerAct はプレイヤーがアクションを実行可能かチェックする

				
				
				
			
				
				<h3 id="TurnManager.ConsumeActionPoints">func (*TurnManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=3894:4004#L129">ConsumeActionPoints</a>
					<a class="permalink" href="index.html#TurnManager.ConsumeActionPoints">&#xb6;</a>
					
					
				</h3>
				<pre>func (tm *<a href="index.html#TurnManager">TurnManager</a>) ConsumeActionPoints(world <a href="../world/index.html">w</a>.<a href="../world/index.html#World">World</a>, entity <a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/">ecs</a>.<a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/#Entity">Entity</a>, actionName <a href="http://localhost:8888/pkg/builtin/#string">string</a>, cost <a href="http://localhost:8888/pkg/builtin/#int">int</a>) <a href="http://localhost:8888/pkg/builtin/#bool">bool</a></pre>
				<p>ConsumeActionPoints はエンティティのアクションポイントを消費する
CDDAスタイルの共通AP管理システム

				
				
				
			
				
				<h3 id="TurnManager.ConsumePlayerMoves">func (*TurnManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=1446:1516#L49">ConsumePlayerMoves</a>
					<a class="permalink" href="index.html#TurnManager.ConsumePlayerMoves">&#xb6;</a>
					
					
				</h3>
				<pre>func (tm *<a href="index.html#TurnManager">TurnManager</a>) ConsumePlayerMoves(actionName <a href="http://localhost:8888/pkg/builtin/#string">string</a>, cost <a href="http://localhost:8888/pkg/builtin/#int">int</a>)</pre>
				<p>ConsumePlayerMoves はプレイヤーの移動ポイントを消費する

				
				
				
			
				
				<h3 id="TurnManager.IsAITurn">func (*TurnManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=2726:2764#L93">IsAITurn</a>
					<a class="permalink" href="index.html#TurnManager.IsAITurn">&#xb6;</a>
					
					
				</h3>
				<pre>func (tm *<a href="index.html#TurnManager">TurnManager</a>) IsAITurn() <a href="http://localhost:8888/pkg/builtin/#bool">bool</a></pre>
				<p>IsAITurn はAIのターンかチェックする

				
				
				
			
				
				<h3 id="TurnManager.IsPlayerTurn">func (*TurnManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=2592:2634#L88">IsPlayerTurn</a>
					<a class="permalink" href="index.html#TurnManager.IsPlayerTurn">&#xb6;</a>
					
					
				</h3>
				<pre>func (tm *<a href="index.html#TurnManager">TurnManager</a>) IsPlayerTurn() <a href="http://localhost:8888/pkg/builtin/#bool">bool</a></pre>
				<p>IsPlayerTurn はプレイヤーのターンかチェックする

				
				
				
			
				
				<h3 id="TurnManager.RestoreAllActionPoints">func (*TurnManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=5432:5492#L180">RestoreAllActionPoints</a>
					<a class="permalink" href="index.html#TurnManager.RestoreAllActionPoints">&#xb6;</a>
					
					
				</h3>
				<pre>func (tm *<a href="index.html#TurnManager">TurnManager</a>) RestoreAllActionPoints(world <a href="../world/index.html">w</a>.<a href="../world/index.html#World">World</a>)</pre>
				<p>RestoreAllActionPoints は全エンティティのAPを回復する（ターン終了時）

				
				
				
			
				
				<h3 id="TurnManager.StartNewTurn">func (*TurnManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=2316:2353#L77">StartNewTurn</a>
					<a class="permalink" href="index.html#TurnManager.StartNewTurn">&#xb6;</a>
					
					
				</h3>
				<pre>func (tm *<a href="index.html#TurnManager">TurnManager</a>) StartNewTurn()</pre>
				<p>StartNewTurn は新しいターンを開始する

				
				
				
			
		
			
			
			<h2 id="TurnPhase">type <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=231:249#L1">TurnPhase</a>
				<a class="permalink" href="index.html#TurnPhase">&#xb6;</a>
				
				
			</h2>
			<p>TurnPhase はターンの段階を表す

			<pre>type TurnPhase <a href="http://localhost:8888/pkg/builtin/#int">int</a></pre>

			
				
				<pre>const (
    <span class="comment">// PlayerTurn プレイヤーのターン（入力待ち・アクション実行）</span>
    <span id="PlayerTurn">PlayerTurn</span> <a href="index.html#TurnPhase">TurnPhase</a> = <a href="http://localhost:8888/pkg/builtin/#iota">iota</a>
    <span class="comment">// AITurn AI・NPCのターン（一括処理）</span>
    <span id="AITurn">AITurn</span>
    <span class="comment">// TurnEnd ターン終了処理</span>
    <span id="TurnEnd">TurnEnd</span>
)</pre>
			

			

			
			
			

			

			
				
				<h3 id="TurnPhase.String">func (TurnPhase) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/turns/manager.go?s=477:512#L12">String</a>
					<a class="permalink" href="index.html#TurnPhase.String">&#xb6;</a>
					
					
				</h3>
				<pre>func (tp <a href="index.html#TurnPhase">TurnPhase</a>) String() <a href="http://localhost:8888/pkg/builtin/#string">string</a></pre>
				
				
				
				
			
		
	

	







<div id="footer">
Build version go1.24.7.<br>
Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
the content of this page is licensed under the
Creative Commons Attribution 3.0 License,
and code is licensed under a <a href="http://localhost:8888/LICENSE">BSD license</a>.<br>
<a href="https://golang.org/doc/tos.html">Terms of Service</a> |
<a href="https://www.google.com/intl/en/policies/privacy/">Privacy Policy</a>
</div>

</div><!-- .container -->
</div><!-- #page -->
</body>
</html>
