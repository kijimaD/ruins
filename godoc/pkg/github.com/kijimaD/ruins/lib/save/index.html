<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>save - Go Documentation Server</title>

<link type="text/css" rel="stylesheet" href="../../../../../../lib/godoc/style.css">

<script>window.initFuncs = [];</script>
<script src="../../../../../../lib/godoc/jquery.js" defer></script>



<script>var goVersion = "go1.24.6";</script>
<script src="../../../../../../lib/godoc/godocs.js" defer></script>
</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="http://localhost:8888/pkg/">Go Documentation Server</a></div>
<div class="top-heading" id="heading-narrow"><a href="http://localhost:8888/pkg/">GoDoc</a></div>
<a href="index.html#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>
<form method="GET" action="http://localhost:8888/search">
<div id="menu">

<span class="search-box"><input type="search" id="search" name="q" placeholder="Search" aria-label="Search" required><button type="submit"><span><!-- magnifying glass: --><svg width="24" height="24" viewBox="0 0 24 24"><title>submit search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg></span></button></span>
</div>
</form>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package save
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "github.com/kijimaD/ruins/lib/save"</code></dd>
			</dl>
			<dl>
			<dd><a href="index.html#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="index.html#pkg-index" class="indexLink">Index</a></dd>
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				<p>Package save は安定ID + リフレクションベースのECSシリアライゼーションシステムを提供する。
<p>## 概要
<p>このパッケージはBevy ECSの安定ID概念とGoのリフレクション機能を組み合わせて、
ECSワールドの状態を安全にセーブ・ロードする機能を提供します。
<p>## 主要な特徴
<p>### 1. 安定ID システム
- エンティティIDは世代管理により安定性を保証
- エンティティの削除・再作成時も参照の整合性を維持
- セーブファイル間でのエンティティ参照が安全
<p>### 2. 自動リフレクション
- Goのreflectionを使用してコンポーネント型を自動検出
- 手動でのコンポーネント登録が不要
- 新しいコンポーネント追加時の修正が最小限
<p>### 3. エンティティ参照の自動解決
- AIVision.TargetEntity などのエンティティ間参照を自動処理
- セーブ時は安定IDに変換、ロード時は実エンティティに復元
<p>## 使用方法
<p>### 基本的なセーブ・ロード
<p>```go
// シリアライゼーションマネージャーを作成
manager := save.NewSerializationManager(&quot;./saves&quot;)
<p>// ワールドを保存
err := manager.SaveWorld(world, &quot;slot1&quot;)
<pre>if err != nil {
    log.Fatal(err)
}
</pre>
<p>// ワールドを読み込み
err = manager.LoadWorld(world, &quot;slot1&quot;)
<pre>if err != nil {
    log.Fatal(err)
}
</pre>
<p>```
<p>### 新しいコンポーネントの対応
<p>新しいコンポーネント型を追加する場合は、reflection.goの
InitializeFromWorld関数に登録を追加してください：
<p>```go
<pre>func (r *ComponentRegistry) InitializeFromWorld(world w.World) error {
    // ... 既存の登録 ...

    // 新しいコンポーネントを登録
    r.registerComponent(
        reflect.TypeOf(&amp;gc.NewComponent{}),
        components.NewComponent,
        r.extractNewComponent,
        r.restoreNewComponent,
        nil, // エンティティ参照がない場合
    )

    return nil
}
</pre>
<p>```
<p>そして対応する抽出・復元関数を実装：
<p>```go
<pre>func (r *ComponentRegistry) extractNewComponent(world w.World, entity ecs.Entity) (interface{}, bool) {
    if !entity.HasComponent(world.Components.NewComponent) {
        return nil, false
    }
    comp := world.Components.NewComponent.Get(entity).(*gc.NewComponent)
    return *comp, true
}

func (r *ComponentRegistry) restoreNewComponent(world w.World, entity ecs.Entity, data interface{}) error {
    comp, ok := data.(gc.NewComponent)
    if !ok {
        return fmt.Errorf(&quot;invalid NewComponent data type: %T&quot;, data)
    }
    world.Components.NewComponent.Set(entity, &amp;comp)
    return nil
}
</pre>
<p>```
<p>## 設計原則
<p>### 型安全性
- Goの型システムを活用して実行時エラーを最小化
- リフレクションを使用しつつも型安全性を保持
<p>### パフォーマンス
- コンポーネントレジストリの初期化は1回のみ
- 安定IDマッピングはハッシュマップで高速アクセス
<p>### 拡張性
- 新しいコンポーネント型の追加が容易
- セーブデータフォーマットの後方互換性を考慮
<p>### エラーハンドリング
- 不正なセーブデータに対して適切なエラーメッセージ
- 部分的な復元エラーでも可能な限り処理を継続
<p>## 制限事項
<p>### サポートされるコンポーネント型
現在サポートされているコンポーネント：
- Position, Velocity, Camera
- AIVision, AIRoaming, AIChasing
- SpriteRender, GridElement
- NullComponent (Operator, BlockView, BlockPass)
<p>### エンティティ参照
現在、AIVision.TargetEntityのみ自動処理されます。
他のエンティティ参照を持つコンポーネントを追加する場合は、
対応するResolveRefFunc を実装する必要があります。
<p>## ファイル形式
<p>セーブファイルはJSON形式で、以下の構造を持ちます：
<p>```json
<pre>{
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;timestamp&quot;: &quot;2025-01-XX...&quot;,
  &quot;world&quot;: {
    &quot;entities&quot;: [
      {
        &quot;stable_id&quot;: {&quot;index&quot;: 1, &quot;generation&quot;: 0},
        &quot;components&quot;: {
          &quot;Position&quot;: {
            &quot;type&quot;: &quot;Position&quot;,
            &quot;data&quot;: {&quot;x&quot;: 100, &quot;y&quot;: 200}
          }
        }
      }
    ]
  }
}
</pre>
<p>```
<p>## パッケージ責務
<p>- **stable_id.go**: 安定ID管理システム
- **reflection.go**: コンポーネント型のリフレクション・レジストリ
- **manager.go**: セーブ・ロード処理の統合管理
- **manager_test.go**: 総合テストスイート
<p>## 使い分け
<p>このパッケージは以下の用途に適しています：
- ゲームの進行状況保存
- デバッグ用のワールド状態スナップショット
- レベルエディタでの作成データ保存
<p>高頻度のスナップショット（ネットワーク同期等）には、
より軽量なバイナリ形式を検討することを推奨します。
<p>Package save は安定ID + リフレクションベースのECSシリアライゼーションを提供する

				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
				<dd><a href="index.html#pkg-constants">Constants</a></dd>
			
			
				<dd><a href="index.html#pkg-variables">Variables</a></dd>
			
			
			
				
				<dd><a href="index.html#ComponentData">type ComponentData</a></dd>
				
				
			
				
				<dd><a href="index.html#ComponentRegistry">type ComponentRegistry</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#NewComponentRegistry">func NewComponentRegistry() *ComponentRegistry</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#ComponentRegistry.GetAllTypes">func (r *ComponentRegistry) GetAllTypes() []*ComponentTypeInfo</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#ComponentRegistry.GetTypeInfo">func (r *ComponentRegistry) GetTypeInfo(typ reflect.Type) (*ComponentTypeInfo, bool)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#ComponentRegistry.GetTypeInfoByName">func (r *ComponentRegistry) GetTypeInfoByName(name string) (*ComponentTypeInfo, bool)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#ComponentRegistry.InitializeFromWorld">func (r *ComponentRegistry) InitializeFromWorld(world w.World) error</a></dd>
				
			
				
				<dd><a href="index.html#ComponentTypeInfo">type ComponentTypeInfo</a></dd>
				
				
			
				
				<dd><a href="index.html#Data">type Data</a></dd>
				
				
			
				
				<dd><a href="index.html#EntityReference">type EntityReference</a></dd>
				
				
			
				
				<dd><a href="index.html#EntitySaveData">type EntitySaveData</a></dd>
				
				
			
				
				<dd><a href="index.html#SerializationManager">type SerializationManager</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#NewSerializationManager">func NewSerializationManager(saveDir string) *SerializationManager</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#SerializationManager.GetComponentRegistry">func (sm *SerializationManager) GetComponentRegistry() *ComponentRegistry</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#SerializationManager.GetSaveFileTimestamp">func (sm *SerializationManager) GetSaveFileTimestamp(slotName string) (time.Time, error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#SerializationManager.GetStableIDManager">func (sm *SerializationManager) GetStableIDManager() *StableIDManager</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#SerializationManager.LoadWorld">func (sm *SerializationManager) LoadWorld(world w.World, slotName string) error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#SerializationManager.SaveFileExists">func (sm *SerializationManager) SaveFileExists(slotName string) bool</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#SerializationManager.SaveWorld">func (sm *SerializationManager) SaveWorld(world w.World, slotName string) error</a></dd>
				
			
				
				<dd><a href="index.html#StableID">type StableID</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#StableID.IsNull">func (id StableID) IsNull() bool</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#StableID.String">func (id StableID) String() string</a></dd>
				
			
				
				<dd><a href="index.html#StableIDManager">type StableIDManager</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#NewStableIDManager">func NewStableIDManager() *StableIDManager</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#StableIDManager.Clear">func (m *StableIDManager) Clear()</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#StableIDManager.GetAllStableIDs">func (m *StableIDManager) GetAllStableIDs() []StableID</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#StableIDManager.GetEntity">func (m *StableIDManager) GetEntity(stableID StableID) (ecs.Entity, bool)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#StableIDManager.GetStableID">func (m *StableIDManager) GetStableID(entity ecs.Entity) StableID</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#StableIDManager.IsValid">func (m *StableIDManager) IsValid(stableID StableID) bool</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#StableIDManager.RegisterEntity">func (m *StableIDManager) RegisterEntity(entity ecs.Entity, stableID StableID) error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="index.html#StableIDManager.UnregisterEntity">func (m *StableIDManager) UnregisterEntity(entity ecs.Entity)</a></dd>
				
			
				
				<dd><a href="index.html#WorldSaveData">type WorldSaveData</a></dd>
				
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/desktop.go">desktop.go</a>
			
				<a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/doc.go">doc.go</a>
			
				<a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go">manager.go</a>
			
				<a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/reflection.go">reflection.go</a>
			
				<a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go">stable_id.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
			<h2 id="pkg-constants">Constants</h2>
			
				<p>コンポーネント名の定数

				<pre>const (
    <span id="ComponentAIVision">ComponentAIVision</span>           = &#34;AIVision&#34;
    <span id="ComponentOperator">ComponentOperator</span>           = &#34;Operator&#34;
    <span id="ComponentBlockView">ComponentBlockView</span>          = &#34;BlockView&#34;
    <span id="ComponentBlockPass">ComponentBlockPass</span>          = &#34;BlockPass&#34;
    <span id="ComponentPlayer">ComponentPlayer</span>             = &#34;Player&#34;
    <span id="ComponentJob">ComponentJob</span>                = &#34;Job&#34;
    <span id="ComponentFactionAllyData">ComponentFactionAllyData</span>    = &#34;FactionAllyData&#34;
    <span id="ComponentFactionEnemyData">ComponentFactionEnemyData</span>   = &#34;FactionEnemyData&#34;
    <span id="ComponentInParty">ComponentInParty</span>            = &#34;InParty&#34;
    <span id="ComponentItem">ComponentItem</span>               = &#34;Item&#34;
    <span id="ComponentLocationInBackpack">ComponentLocationInBackpack</span> = &#34;LocationInBackpack&#34;
    <span id="ComponentLocationEquipped">ComponentLocationEquipped</span>   = &#34;LocationEquipped&#34;
    <span id="ComponentLocationOnField">ComponentLocationOnField</span>    = &#34;LocationOnField&#34;
    <span id="ComponentLocationNone">ComponentLocationNone</span>       = &#34;LocationNone&#34;
    <span id="ComponentEquipmentChanged">ComponentEquipmentChanged</span>   = &#34;EquipmentChanged&#34;
)</pre>
			
		
		
			<h2 id="pkg-variables">Variables</h2>
			
				<p>NullStableID は無効な安定IDを表す

				<pre>var <span id="NullStableID">NullStableID</span> = <a href="index.html#StableID">StableID</a>{<a href="index.html#StableID.Index">Index</a>: 0, <a href="index.html#StableID.Generation">Generation</a>: 0}</pre>
			
		
		
		
			
			
			<h2 id="ComponentData">type <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=1636:1729#L46">ComponentData</a>
				<a class="permalink" href="index.html#ComponentData">&#xb6;</a>
				
				
			</h2>
			<p>ComponentData はコンポーネントデータ

			<pre>type ComponentData struct {
<span id="ComponentData.Type"></span>    Type <a href="http://localhost:8888/pkg/builtin/#string">string</a>      `json:&#34;type&#34;`
<span id="ComponentData.Data"></span>    Data interface{} `json:&#34;data&#34;`
}
</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="ComponentRegistry">type <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/reflection.go?s=1036:1199#L14">ComponentRegistry</a>
				<a class="permalink" href="index.html#ComponentRegistry">&#xb6;</a>
				
				
			</h2>
			<p>ComponentRegistry はコンポーネント型の自動検出と管理を行う

			<pre>type ComponentRegistry struct {
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewComponentRegistry">func <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/reflection.go?s=1264:1310#L22">NewComponentRegistry</a>
					<a class="permalink" href="index.html#NewComponentRegistry">&#xb6;</a>
					
					
				</h3>
				<pre>func NewComponentRegistry() *<a href="index.html#ComponentRegistry">ComponentRegistry</a></pre>
				<p>NewComponentRegistry は新しいComponentRegistryを作成

				
				
			

			
				
				<h3 id="ComponentRegistry.GetAllTypes">func (*ComponentRegistry) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/reflection.go?s=10189:10251#L213">GetAllTypes</a>
					<a class="permalink" href="index.html#ComponentRegistry.GetAllTypes">&#xb6;</a>
					
					
				</h3>
				<pre>func (r *<a href="index.html#ComponentRegistry">ComponentRegistry</a>) GetAllTypes() []*<a href="index.html#ComponentTypeInfo">ComponentTypeInfo</a></pre>
				<p>GetAllTypes は登録されている全ての型を取得

				
				
				
			
				
				<h3 id="ComponentRegistry.GetTypeInfo">func (*ComponentRegistry) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/reflection.go?s=9631:9715#L190">GetTypeInfo</a>
					<a class="permalink" href="index.html#ComponentRegistry.GetTypeInfo">&#xb6;</a>
					
					
				</h3>
				<pre>func (r *<a href="index.html#ComponentRegistry">ComponentRegistry</a>) GetTypeInfo(typ <a href="http://localhost:8888/pkg/reflect/">reflect</a>.<a href="http://localhost:8888/pkg/reflect/#Type">Type</a>) (*<a href="index.html#ComponentTypeInfo">ComponentTypeInfo</a>, <a href="http://localhost:8888/pkg/builtin/#bool">bool</a>)</pre>
				<p>GetTypeInfo は型情報を取得

				
				
				
			
				
				<h3 id="ComponentRegistry.GetTypeInfoByName">func (*ComponentRegistry) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/reflection.go?s=9870:9955#L199">GetTypeInfoByName</a>
					<a class="permalink" href="index.html#ComponentRegistry.GetTypeInfoByName">&#xb6;</a>
					
					
				</h3>
				<pre>func (r *<a href="index.html#ComponentRegistry">ComponentRegistry</a>) GetTypeInfoByName(name <a href="http://localhost:8888/pkg/builtin/#string">string</a>) (*<a href="index.html#ComponentTypeInfo">ComponentTypeInfo</a>, <a href="http://localhost:8888/pkg/builtin/#bool">bool</a>)</pre>
				<p>GetTypeInfoByName は名前から型情報を取得

				
				
				
			
				
				<h3 id="ComponentRegistry.InitializeFromWorld">func (*ComponentRegistry) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/reflection.go?s=1548:1616#L30">InitializeFromWorld</a>
					<a class="permalink" href="index.html#ComponentRegistry.InitializeFromWorld">&#xb6;</a>
					
					
				</h3>
				<pre>func (r *<a href="index.html#ComponentRegistry">ComponentRegistry</a>) InitializeFromWorld(world <a href="../world/index.html">w</a>.<a href="../world/index.html#World">World</a>) <a href="http://localhost:8888/pkg/builtin/#error">error</a></pre>
				<p>InitializeFromWorld はワールドから自動的にコンポーネント型を検出・登録

				
				
				
			
		
			
			
			<h2 id="ComponentTypeInfo">type <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/reflection.go?s=232:952#L4">ComponentTypeInfo</a>
				<a class="permalink" href="index.html#ComponentTypeInfo">&#xb6;</a>
				
				
			</h2>
			<p>ComponentTypeInfo はコンポーネント型の情報

			<pre>type ComponentTypeInfo struct {
<span id="ComponentTypeInfo.Name"></span>    Name           <a href="http://localhost:8888/pkg/builtin/#string">string</a>                                                         <span class="comment">// 型名</span>
<span id="ComponentTypeInfo.Type"></span>    Type           <a href="http://localhost:8888/pkg/reflect/">reflect</a>.<a href="http://localhost:8888/pkg/reflect/#Type">Type</a>                                                   <span class="comment">// 型情報</span>
<span id="ComponentTypeInfo.ComponentRef"></span>    ComponentRef   interface{}                                                    <span class="comment">// ECSコンポーネントへの参照</span>
<span id="ComponentTypeInfo.ExtractFunc"></span>    ExtractFunc    func(<a href="../world/index.html">w</a>.<a href="../world/index.html#World">World</a>, <a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/">ecs</a>.<a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/#Entity">Entity</a>) (interface{}, <a href="http://localhost:8888/pkg/builtin/#bool">bool</a>)                  <span class="comment">// エンティティからコンポーネントを抽出</span>
<span id="ComponentTypeInfo.RestoreFunc"></span>    RestoreFunc    func(<a href="../world/index.html">w</a>.<a href="../world/index.html#World">World</a>, <a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/">ecs</a>.<a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/#Entity">Entity</a>, interface{}) <a href="http://localhost:8888/pkg/builtin/#error">error</a>                   <span class="comment">// エンティティにコンポーネントを復元</span>
<span id="ComponentTypeInfo.ResolveRefFunc"></span>    ResolveRefFunc func(<a href="../world/index.html">w</a>.<a href="../world/index.html#World">World</a>, <a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/">ecs</a>.<a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/#Entity">Entity</a>, interface{}, *<a href="index.html#StableIDManager">StableIDManager</a>) <a href="http://localhost:8888/pkg/builtin/#error">error</a> <span class="comment">// エンティティ参照を解決</span>
}
</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="Data">type <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=1000:1235#L27">Data</a>
				<a class="permalink" href="index.html#Data">&#xb6;</a>
				
				
			</h2>
			<p>Data はセーブデータの最上位構造

			<pre>type Data struct {
<span id="Data.Version"></span>    Version   <a href="http://localhost:8888/pkg/builtin/#string">string</a>        `json:&#34;version&#34;`
<span id="Data.Timestamp"></span>    Timestamp <a href="http://localhost:8888/pkg/time/">time</a>.<a href="http://localhost:8888/pkg/time/#Time">Time</a>     `json:&#34;timestamp&#34;`
<span id="Data.World"></span>    World     <a href="index.html#WorldSaveData">WorldSaveData</a> `json:&#34;world&#34;`
<span id="Data.Checksum"></span>    Checksum  <a href="http://localhost:8888/pkg/builtin/#string">string</a>        `json:&#34;checksum&#34;` <span class="comment">// データ改ざん検知用ハッシュ値</span>
}
</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="EntityReference">type <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=1799:1892#L52">EntityReference</a>
				<a class="permalink" href="index.html#EntityReference">&#xb6;</a>
				
				
			</h2>
			<p>EntityReference はエンティティ参照のセーブデータ

			<pre>type EntityReference struct {
<span id="EntityReference.TargetStableID"></span>    TargetStableID *<a href="index.html#StableID">StableID</a> `json:&#34;target_stable_id,omitempty&#34;`
}
</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="EntitySaveData">type <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=1440:1583#L40">EntitySaveData</a>
				<a class="permalink" href="index.html#EntitySaveData">&#xb6;</a>
				
				
			</h2>
			<p>EntitySaveData は単一エンティティのセーブデータ

			<pre>type EntitySaveData struct {
<span id="EntitySaveData.StableID"></span>    StableID   <a href="index.html#StableID">StableID</a>                 `json:&#34;stable_id&#34;`
<span id="EntitySaveData.Components"></span>    Components map[<a href="http://localhost:8888/pkg/builtin/#string">string</a>]<a href="index.html#ComponentData">ComponentData</a> `json:&#34;components&#34;`
}
</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="SerializationManager">type <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=2005:2141#L57">SerializationManager</a>
				<a class="permalink" href="index.html#SerializationManager">&#xb6;</a>
				
				
			</h2>
			<p>SerializationManager は安定ID + リフレクションベースのシリアライゼーションを管理

			<pre>type SerializationManager struct {
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewSerializationManager">func <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=2212:2278#L64">NewSerializationManager</a>
					<a class="permalink" href="index.html#NewSerializationManager">&#xb6;</a>
					
					
				</h3>
				<pre>func NewSerializationManager(saveDir <a href="http://localhost:8888/pkg/builtin/#string">string</a>) *<a href="index.html#SerializationManager">SerializationManager</a></pre>
				<p>NewSerializationManager は新しいSerializationManagerを作成

				
				
			

			
				
				<h3 id="SerializationManager.GetComponentRegistry">func (*SerializationManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=23244:23317#L674">GetComponentRegistry</a>
					<a class="permalink" href="index.html#SerializationManager.GetComponentRegistry">&#xb6;</a>
					
					
				</h3>
				<pre>func (sm *<a href="index.html#SerializationManager">SerializationManager</a>) GetComponentRegistry() *<a href="index.html#ComponentRegistry">ComponentRegistry</a></pre>
				<p>GetComponentRegistry はコンポーネントレジストリを取得

				
				
				
			
				
				<h3 id="SerializationManager.GetSaveFileTimestamp">func (*SerializationManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=22645:22733#L653">GetSaveFileTimestamp</a>
					<a class="permalink" href="index.html#SerializationManager.GetSaveFileTimestamp">&#xb6;</a>
					
					
				</h3>
				<pre>func (sm *<a href="index.html#SerializationManager">SerializationManager</a>) GetSaveFileTimestamp(slotName <a href="http://localhost:8888/pkg/builtin/#string">string</a>) (<a href="http://localhost:8888/pkg/time/">time</a>.<a href="http://localhost:8888/pkg/time/#Time">Time</a>, <a href="http://localhost:8888/pkg/builtin/#error">error</a>)</pre>
				<p>GetSaveFileTimestamp はセーブファイルのタイムスタンプを取得する
JSONファイルの中身のtimestampフィールドを読み取る

				
				
				
			
				
				<h3 id="SerializationManager.GetStableIDManager">func (*SerializationManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=23069:23138#L669">GetStableIDManager</a>
					<a class="permalink" href="index.html#SerializationManager.GetStableIDManager">&#xb6;</a>
					
					
				</h3>
				<pre>func (sm *<a href="index.html#SerializationManager">SerializationManager</a>) GetStableIDManager() *<a href="index.html#StableIDManager">StableIDManager</a></pre>
				<p>GetStableIDManager は安定IDマネージャーを取得

				
				
				
			
				
				<h3 id="SerializationManager.LoadWorld">func (*SerializationManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=3543:3622#L110">LoadWorld</a>
					<a class="permalink" href="index.html#SerializationManager.LoadWorld">&#xb6;</a>
					
					
				</h3>
				<pre>func (sm *<a href="index.html#SerializationManager">SerializationManager</a>) LoadWorld(world <a href="../world/index.html">w</a>.<a href="../world/index.html#World">World</a>, slotName <a href="http://localhost:8888/pkg/builtin/#string">string</a>) <a href="http://localhost:8888/pkg/builtin/#error">error</a></pre>
				<p>LoadWorld はファイルからワールドを復元

				
				
				
			
				
				<h3 id="SerializationManager.SaveFileExists">func (*SerializationManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=22372:22440#L647">SaveFileExists</a>
					<a class="permalink" href="index.html#SerializationManager.SaveFileExists">&#xb6;</a>
					
					
				</h3>
				<pre>func (sm *<a href="index.html#SerializationManager">SerializationManager</a>) SaveFileExists(slotName <a href="http://localhost:8888/pkg/builtin/#string">string</a>) <a href="http://localhost:8888/pkg/builtin/#bool">bool</a></pre>
				<p>SaveFileExists はセーブファイルが存在するかチェックする

				
				
				
			
				
				<h3 id="SerializationManager.SaveWorld">func (*SerializationManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=2575:2654#L78">SaveWorld</a>
					<a class="permalink" href="index.html#SerializationManager.SaveWorld">&#xb6;</a>
					
					
				</h3>
				<pre>func (sm *<a href="index.html#SerializationManager">SerializationManager</a>) SaveWorld(world <a href="../world/index.html">w</a>.<a href="../world/index.html#World">World</a>, slotName <a href="http://localhost:8888/pkg/builtin/#string">string</a>) <a href="http://localhost:8888/pkg/builtin/#error">error</a></pre>
				<p>SaveWorld はワールド全体をファイルに保存

				
				
				
			
		
			
			
			<h2 id="StableID">type <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go?s=238:448#L2">StableID</a>
				<a class="permalink" href="index.html#StableID">&#xb6;</a>
				
				
			</h2>
			<p>StableID は安定エンティティ識別子

			<pre>type StableID struct {
<span id="StableID.Index"></span>    Index      <a href="http://localhost:8888/pkg/builtin/#uint32">uint32</a> `json:&#34;index&#34;`      <span class="comment">// エンティティのインデックス</span>
<span id="StableID.Generation"></span>    Generation <a href="http://localhost:8888/pkg/builtin/#uint32">uint32</a> `json:&#34;generation&#34;` <span class="comment">// 世代番号（削除/再利用時にインクリメント）</span>
}
</pre>

			

			

			
			
			

			

			
				
				<h3 id="StableID.IsNull">func (StableID) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go?s=5044:5076#L170">IsNull</a>
					<a class="permalink" href="index.html#StableID.IsNull">&#xb6;</a>
					
					
				</h3>
				<pre>func (id <a href="index.html#StableID">StableID</a>) IsNull() <a href="http://localhost:8888/pkg/builtin/#bool">bool</a></pre>
				<p>IsNull は安定IDが無効（null）かどうかをチェック

				
				
				
			
				
				<h3 id="StableID.String">func (StableID) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go?s=4872:4906#L165">String</a>
					<a class="permalink" href="index.html#StableID.String">&#xb6;</a>
					
					
				</h3>
				<pre>func (id <a href="index.html#StableID">StableID</a>) String() <a href="http://localhost:8888/pkg/builtin/#string">string</a></pre>
				<p>String は安定IDの文字列表現を返す

				
				
				
			
		
			
			
			<h2 id="StableIDManager">type <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go?s=499:944#L8">StableIDManager</a>
				<a class="permalink" href="index.html#StableIDManager">&#xb6;</a>
				
				
			</h2>
			<p>StableIDManager は安定IDの管理を行う

			<pre>type StableIDManager struct {
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewStableIDManager">func <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go?s=1005:1047#L24">NewStableIDManager</a>
					<a class="permalink" href="index.html#NewStableIDManager">&#xb6;</a>
					
					
				</h3>
				<pre>func NewStableIDManager() *<a href="index.html#StableIDManager">StableIDManager</a></pre>
				<p>NewStableIDManager は新しいStableIDManagerを作成

				
				
			

			
				
				<h3 id="StableIDManager.Clear">func (*StableIDManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go?s=4211:4244#L140">Clear</a>
					<a class="permalink" href="index.html#StableIDManager.Clear">&#xb6;</a>
					
					
				</h3>
				<pre>func (m *<a href="index.html#StableIDManager">StableIDManager</a>) Clear()</pre>
				<p>Clear は全ての登録をクリア

				
				
				
			
				
				<h3 id="StableIDManager.GetAllStableIDs">func (*StableIDManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go?s=4554:4608#L152">GetAllStableIDs</a>
					<a class="permalink" href="index.html#StableIDManager.GetAllStableIDs">&#xb6;</a>
					
					
				</h3>
				<pre>func (m *<a href="index.html#StableIDManager">StableIDManager</a>) GetAllStableIDs() []<a href="index.html#StableID">StableID</a></pre>
				<p>GetAllStableIDs は登録されている全ての安定IDを取得

				
				
				
			
				
				<h3 id="StableIDManager.GetEntity">func (*StableIDManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go?s=2316:2389#L72">GetEntity</a>
					<a class="permalink" href="index.html#StableIDManager.GetEntity">&#xb6;</a>
					
					
				</h3>
				<pre>func (m *<a href="index.html#StableIDManager">StableIDManager</a>) GetEntity(stableID <a href="index.html#StableID">StableID</a>) (<a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/">ecs</a>.<a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/#Entity">Entity</a>, <a href="http://localhost:8888/pkg/builtin/#bool">bool</a>)</pre>
				<p>GetEntity は安定IDから実際のエンティティを取得

				
				
				
			
				
				<h3 id="StableIDManager.GetStableID">func (*StableIDManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go?s=1414:1479#L35">GetStableID</a>
					<a class="permalink" href="index.html#StableIDManager.GetStableID">&#xb6;</a>
					
					
				</h3>
				<pre>func (m *<a href="index.html#StableIDManager">StableIDManager</a>) GetStableID(entity <a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/">ecs</a>.<a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/#Entity">Entity</a>) <a href="index.html#StableID">StableID</a></pre>
				<p>GetStableID は実際のエンティティから安定IDを取得（なければ新規作成）

				
				
				
			
				
				<h3 id="StableIDManager.IsValid">func (*StableIDManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go?s=3923:3980#L127">IsValid</a>
					<a class="permalink" href="index.html#StableIDManager.IsValid">&#xb6;</a>
					
					
				</h3>
				<pre>func (m *<a href="index.html#StableIDManager">StableIDManager</a>) IsValid(stableID <a href="index.html#StableID">StableID</a>) <a href="http://localhost:8888/pkg/builtin/#bool">bool</a></pre>
				<p>IsValid は安定IDが現在有効かどうかをチェック

				
				
				
			
				
				<h3 id="StableIDManager.RegisterEntity">func (*StableIDManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go?s=2585:2669#L81">RegisterEntity</a>
					<a class="permalink" href="index.html#StableIDManager.RegisterEntity">&#xb6;</a>
					
					
				</h3>
				<pre>func (m *<a href="index.html#StableIDManager">StableIDManager</a>) RegisterEntity(entity <a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/">ecs</a>.<a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/#Entity">Entity</a>, stableID <a href="index.html#StableID">StableID</a>) <a href="http://localhost:8888/pkg/builtin/#error">error</a></pre>
				<p>RegisterEntity は既存のエンティティに安定IDをマッピング

				
				
				
			
				
				<h3 id="StableIDManager.UnregisterEntity">func (*StableIDManager) <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/stable_id.go?s=3337:3398#L106">UnregisterEntity</a>
					<a class="permalink" href="index.html#StableIDManager.UnregisterEntity">&#xb6;</a>
					
					
				</h3>
				<pre>func (m *<a href="index.html#StableIDManager">StableIDManager</a>) UnregisterEntity(entity <a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/">ecs</a>.<a href="http://localhost:8888/pkg/github.com/x-hgg-x/goecs/v2/#Entity">Entity</a>)</pre>
				<p>UnregisterEntity はエンティティの登録を解除し、世代をインクリメント

				
				
				
			
		
			
			
			<h2 id="WorldSaveData">type <a href="http://localhost:8888/src/github.com/kijimaD/ruins/lib/save/manager.go?s=1297:1371#L35">WorldSaveData</a>
				<a class="permalink" href="index.html#WorldSaveData">&#xb6;</a>
				
				
			</h2>
			<p>WorldSaveData はワールド全体のセーブデータ

			<pre>type WorldSaveData struct {
<span id="WorldSaveData.Entities"></span>    Entities []<a href="index.html#EntitySaveData">EntitySaveData</a> `json:&#34;entities&#34;`
}
</pre>

			

			

			
			
			

			

			
		
	

	







<div id="footer">
Build version go1.24.6.<br>
Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
the content of this page is licensed under the
Creative Commons Attribution 3.0 License,
and code is licensed under a <a href="http://localhost:8888/LICENSE">BSD license</a>.<br>
<a href="https://golang.org/doc/tos.html">Terms of Service</a> |
<a href="https://www.google.com/intl/en/policies/privacy/">Privacy Policy</a>
</div>

</div><!-- .container -->
</div><!-- #page -->
</body>
</html>
