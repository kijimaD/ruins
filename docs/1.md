# systemでキャッシュをグローバル変数にするのをやめる

## 背景

並列実行のテストで、共有キャッシュがたまに競合するのを防ぐ。

## 設計

- 多くのSystemが、キャッシュを持っている。とくに描画系
- Systemは現状関数だが、構造体+メソッドにする
- 構造体フィールドにキャッシュを持たせて、キャッシュの使い道をわかりやすくする
- グローバルのかわりにどこかで持つ必要があるのだが、どこにするか
  - resources は、以前の最上位にある。worldを使えないので、ここでsystemは保存不可
  - world に保存することにした。保存はworld, 実装はsystemという形にする。最初にworld で Systemを初期化して、あとはそれをゲーム全体で使い回す
  - state

## コメント

- importの依存関係...
  - resources
    - world
      - states
        - systems
      - systems
- System interfaceを定義して、形式を統一した
  - 当初、System() のinterface methodに Draw() と Update() を定義していたが、どちらかしか処理がないSystemがあって、どちらを呼び出せばいいのかわかりにくいので Updater, Renderer interfaceに分けることにした
