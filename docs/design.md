## 方針

設計方針を示す。

### コード

- 実装と外観を分離して理解しやすい
- メニュー操作は多くあるため、保守性・操作の一貫性のために共通化する
  - UIコンポーネントが状態を持つ。コンポーネントの変化した状態によって各ステートでのアクションを発火したり変更を反映できる
  - テスト可能である
- テスト可能である

### UI

- キーボードベースの操作である
  - WASD、十字キー、タブ、エンター
- メニューではカーソルキーによる上下の選択と、タブキーによるタブの選択ができる

## 設計

各機能の設計を示す。

### 戦闘

基本的にドラゴンクエストのような一般的なターンベースの、コマンド型戦闘である。

条件。

- テストしやすくなければならない。
- enter待ちにしなければならない
- 最後のメッセージもenter待ちにして表示できる必要がある。単純にlen(gamelog) > 0 の場合表示、だと最後のメッセージが一瞬で消えてしまう
- ダメージ適用などにあたって、戦闘コマンドだけ特殊処理にしたくない。effect package を使って、たとえば道具を使ったときやイベントでのダメージ処理を共通化したい
- メッセージは人間が認識でき遅すぎない速度で1文字ずつ、表示して現在表示中ということがわかりやすくする。一般的なゲームの会話表示と同じ。基本は自動メッセージ送り。後から一行ずつ送ることもできるようにする。
- 1行表示し終わったあとは改行する。メッセージの縦移動もアニメーションで、改行したことがわかりやすくする

考慮。

- グローバルなgamelogの設計だと他のsystemとの連携がやりやすい。しかしメッセージ送りの同期はしづらいし、テストもややこしくなる。メッセージ送りをどういう設計にするか
- すべてのダメージ系イベントは、戦闘だけでなくフィールドやインベントリでのアイテム使用と同様に使えるようにeffectを経由して変更する。だがそうすると結果を表示しづらい
  - 攻撃 が攻撃主/攻撃対象の攻撃力と防御力を加味してeffectに分解されてダメージが与えられる
  - だから、ダメージ量はeffectを発行する前にわかるはずだ
  - 戦闘コマンド → 計算した結果Aに46のダメージ → effect発行 + メッセージ発行
- メッセージがある場合の、messageとeffectの連携が難しい

表示例。

```
<!-- ビジュアルエフェクトとフロー -->
- 「イシハラは地下ザメにハンドガンで攻撃。」
- (ハンドガン攻撃音、攻撃ビジュアルエフェクト表示)
- 「軽戦車に42のダメージ。」
- 「地下ザメはかみつきで攻撃。」
- (かみつき攻撃音、クリティカル音、攻撃ビジュアルエフェクト表示)
- 「会心の一撃。イシハラに93のダメージ。」
- 「イシハラは倒れた」

<!-- 回復 -->
- 「シラセは回復薬を使った。」
- 「シラセは回復した」

<!-- 複数攻撃 -->
- 「シラセはマシンガンで攻撃。」
- (マシンガン攻撃音、攻撃ビジュアルエフェクト表示)
- 「軽戦車に10のダメージ。」
- (マシンガン攻撃音、攻撃ビジュアルエフェクト表示)
- 「軽戦車に12のダメージ。」
- (マシンガン攻撃音、攻撃ビジュアルエフェクト表示)
- 「地下ザメに16のダメージ。」

<!-- あまり効果がない -->
- 「シラセはライムにハンドガンで攻撃。」
- (ハンドガン攻撃音、攻撃ビジュアルエフェクト表示)
- 「ライムには、あまり効果がない。」
- 「ライムに10のダメージ。」

<!-- 倒す -->
- 「イシハラは地下ザメにハンドガンで攻撃。」
- (ハンドガン攻撃音、攻撃ビジュアルエフェクト表示)
- 「地下ザメに100のダメージ。」
- (敵画像フェードアウト)
- 「地下ザメを倒した。」
- 「敵を全滅させた。」
```
